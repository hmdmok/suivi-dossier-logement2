{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/moknial01/Documents/suivi-dossier-logement2/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/moknial01/Documents/suivi-dossier-logement2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/moknial01/Documents/suivi-dossier-logement2/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{Fragment,useState}from\"react\";import Message from\"../Message/Message\";import Progress from\"../ScanDossier/Progress\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var FileUpload=function FileUpload(_ref){var titleFilename=_ref.titleFilename,tosendFilename=_ref.tosendFilename,Num_Dossier=_ref.Num_Dossier,setLink=_ref.setLink,scanelement=_ref.scanelement;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),file=_useState2[0],setFile=_useState2[1];var _useState3=useState(titleFilename),_useState4=_slicedToArray(_useState3,2),filename=_useState4[0],setFilename=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),message=_useState6[0],setMessage=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),uploadPercentage=_useState8[0],setUploadPercentage=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),uploadDone=_useState10[0],setuploadDone=_useState10[1];var onChange=function onChange(e){setUploadPercentage(0);if(e.target.files[0].type===\"image/jpeg\"){var myRenamedFile=new File([e.target.files[0]],tosendFilename,{type:file.type,lastModified:new Date()});setFile(myRenamedFile);setFilename(tosendFilename);}else{setMessage(\"يرجى اختيار صورة\");}};var onUpload=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(eve){var formData;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:eve.preventDefault();formData=new FormData();formData.append(\"file\",file);if(Num_Dossier)try{fetch(\"http://localhost:3005/upload/\"+Num_Dossier,{method:\"post\",body:formData,onUploadProgress:function onUploadProgress(progressEvent){setUploadPercentage(parseInt(Math.round(progressEvent.loaded*100/progressEvent.total)));}}).then(function(response){return response.json();}).then(function(data){var filePath=data.filePath;setMessage(\"File Uploaded\");setuploadDone(true);setLink(filePath,scanelement);}).catch(function(err){return console.log(err);});}catch(err){if(err.response.status===500){setMessage(\"يوجد مشكل في الخادم\");}else{setMessage(err.response.data.msg);}setUploadPercentage(0);}else setMessage(\"يجب ادخال اسم المستخدم\");case 4:case\"end\":return _context.stop();}}},_callee);}));return function onUpload(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(Fragment,{children:[message?/*#__PURE__*/_jsx(Message,{msg:message}):null,/*#__PURE__*/_jsxs(\"div\",{className:\"my-5\",hidden:uploadDone,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"custom-file mb-4\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",className:\"custom-file-input\",id:\"customFile\",onChange:onChange}),/*#__PURE__*/_jsx(\"label\",{className:\"custom-file-label\",htmlFor:\"customFile\",children:filename})]}),/*#__PURE__*/_jsx(Progress,{percentage:uploadPercentage}),/*#__PURE__*/_jsx(\"button\",{onClick:onUpload,className:\"btn btn-primary btn-block mt-4\",children:\"\\u062D\\u0641\\u0638\"})]})]});};export default FileUpload;","map":{"version":3,"names":["React","Fragment","useState","Message","Progress","FileUpload","titleFilename","tosendFilename","Num_Dossier","setLink","scanelement","file","setFile","filename","setFilename","message","setMessage","uploadPercentage","setUploadPercentage","uploadDone","setuploadDone","onChange","e","target","files","type","myRenamedFile","File","lastModified","Date","onUpload","eve","preventDefault","formData","FormData","append","fetch","method","body","onUploadProgress","progressEvent","parseInt","Math","round","loaded","total","then","response","json","data","filePath","catch","err","console","log","status","msg"],"sources":["C:/Users/moknial01/Documents/suivi-dossier-logement2/src/Components/FileUpload/FileUpload.js"],"sourcesContent":["import React, { Fragment, useState } from \"react\";\r\nimport Message from \"../Message/Message\";\r\nimport Progress from \"../ScanDossier/Progress\";\r\n\r\nconst FileUpload = ({\r\n  titleFilename,\r\n  tosendFilename,\r\n  Num_Dossier,\r\n  setLink,\r\n  scanelement,\r\n}) => {\r\n  const [file, setFile] = useState(\"\");\r\n  const [filename, setFilename] = useState(titleFilename);\r\n  const [message, setMessage] = useState(\"\");\r\n  const [uploadPercentage, setUploadPercentage] = useState(0);\r\n  const [uploadDone, setuploadDone] = useState(false);\r\n\r\n  const onChange = (e) => {\r\n    setUploadPercentage(0);\r\n    if (e.target.files[0].type === \"image/jpeg\") {\r\n      const myRenamedFile = new File([e.target.files[0]], tosendFilename, {\r\n        type: file.type,\r\n        lastModified: new Date(),\r\n      });\r\n      setFile(myRenamedFile);\r\n      setFilename(tosendFilename);\r\n    } else {\r\n      setMessage(\"يرجى اختيار صورة\");\r\n    }\r\n  };\r\n\r\n  const onUpload = async (eve) => {\r\n    eve.preventDefault();\r\n    const formData = new FormData();\r\n    formData.append(\"file\", file);\r\n    if (Num_Dossier)\r\n      try {\r\n        fetch(\"http://localhost:3005/upload/\" + Num_Dossier, {\r\n          method: \"post\",\r\n          body: formData,\r\n          onUploadProgress: (progressEvent) => {\r\n            setUploadPercentage(\r\n              parseInt(\r\n                Math.round((progressEvent.loaded * 100) / progressEvent.total)\r\n              )\r\n            );\r\n          },\r\n        })\r\n          .then((response) => response.json())\r\n          .then((data) => {\r\n            const { filePath } = data;\r\n            setMessage(\"File Uploaded\");\r\n            setuploadDone(true);\r\n            setLink(filePath, scanelement);\r\n          })\r\n          .catch((err) => console.log(err));\r\n      } catch (err) {\r\n        if (err.response.status === 500) {\r\n          setMessage(\"يوجد مشكل في الخادم\");\r\n        } else {\r\n          setMessage(err.response.data.msg);\r\n        }\r\n        setUploadPercentage(0);\r\n      }\r\n    else setMessage(\"يجب ادخال اسم المستخدم\");\r\n  };\r\n\r\n  return (\r\n    <Fragment>\r\n      {message ? <Message msg={message} /> : null}\r\n      <div className=\"my-5\" hidden={uploadDone}>\r\n        <div className=\"custom-file mb-4\">\r\n          <input\r\n            type=\"file\"\r\n            className=\"custom-file-input\"\r\n            id=\"customFile\"\r\n            onChange={onChange}\r\n          />\r\n          <label className=\"custom-file-label\" htmlFor=\"customFile\">\r\n            {filename}\r\n          </label>\r\n        </div>\r\n\r\n        <Progress percentage={uploadPercentage} />\r\n\r\n        <button onClick={onUpload} className=\"btn btn-primary btn-block mt-4\">\r\n          حفظ\r\n        </button>\r\n      </div>\r\n    </Fragment>\r\n  );\r\n};\r\n\r\nexport default FileUpload;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}